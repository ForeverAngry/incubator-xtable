"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[376],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>b});var a=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,a,o=function(e,t){if(null==e)return{};var r,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=a.createContext({}),c=function(e){var t=a.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):n(n({},t),e)),r},u=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var r=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=c(r),p=o,b=d["".concat(s,".").concat(p)]||d[p]||g[p]||i;return r?a.createElement(b,n(n({ref:t},u),{},{components:r})):a.createElement(b,n({ref:t},u))}));function b(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=r.length,n=new Array(i);n[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:o,n[1]=l;for(var c=2;c<i;c++)n[c]=r[c];return a.createElement.apply(null,n)}return a.createElement.apply(null,r)}p.displayName="MDXCreateElement"},2085:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>n,default:()=>g,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var a=r(7462),o=(r(7294),r(3905));const i={sidebar_position:4,title:"Google BigQuery"},n="Querying from Google BigQuery",l={unversionedId:"bigquery",id:"bigquery",title:"Google BigQuery",description:"Iceberg tables",source:"@site/docs/bigquery.md",sourceDirName:".",slug:"/bigquery",permalink:"/docs/bigquery",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,title:"Google BigQuery"},sidebar:"docs",previous:{title:"Apache Spark",permalink:"/docs/spark"},next:{title:"Presto",permalink:"/docs/presto"}},s={},c=[{value:"Iceberg tables",id:"iceberg-tables",level:3},{value:"Using Iceberg JSON metadata file to create the Iceberg BigLake tables:",id:"using-iceberg-json-metadata-file-to-create-the-iceberg-biglake-tables",level:4},{value:"Steps to add additional configurations to the Hudi writers:",id:"steps-to-add-additional-configurations-to-the-hudi-writers",level:4},{value:"Using BigLake Metastore to create the Iceberg BigLake tables:",id:"using-biglake-metastore-to-create-the-iceberg-biglake-tables",level:4},{value:"Hudi and Delta tables",id:"hudi-and-delta-tables",level:3}],u={toc:c},d="wrapper";function g(e){let{components:t,...r}=e;return(0,o.kt)(d,(0,a.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"querying-from-google-bigquery"},"Querying from Google BigQuery"),(0,o.kt)("h3",{id:"iceberg-tables"},"Iceberg tables"),(0,o.kt)("p",null,"To read a OneTable synced ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/bigquery/docs/iceberg-tables"},"Iceberg table from BigQuery"),",\nyou have two options:"),(0,o.kt)("h4",{id:"using-iceberg-json-metadata-file-to-create-the-iceberg-biglake-tables"},(0,o.kt)("a",{parentName:"h4",href:"https://cloud.google.com/bigquery/docs/iceberg-tables#create-using-metadata-file"},"Using Iceberg JSON metadata file to create the Iceberg BigLake tables"),":"),(0,o.kt)("p",null,"OneTable outputs metadata files for Iceberg target format syncs which can be used by BigQuery\nto read the BigLake tables."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql",metastring:'md title="sql"',md:!0,title:'"sql"'},"CREATE EXTERNAL TABLE onetable_synced_iceberg_table\nWITH CONNECTION `myproject.mylocation.myconnection`\nOPTIONS (\n     format = 'ICEBERG',\n     uris = [\"gs://mybucket/mydata/mytable/metadata/iceberg.metadata.json\"]\n )\n")),(0,o.kt)("admonition",{title:"Note:",type:"danger"},(0,o.kt)("p",{parentName:"admonition"},"This method requires you to manually update the latest metadata when there are table updates and hence ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/bigquery/docs/iceberg-tables#create-using-biglake-metastore"},"Google\nrecommends using BigLake Metastore"),"\nfor creating Iceberg BigLake tables. Follow the guide on ",(0,o.kt)("a",{parentName:"p",href:"/docs/biglake-metastore"},"Syncing to BigLake Metastore")," for the steps.")),(0,o.kt)("admonition",{title:"Important: For Hudi source format to Iceberg target format use cases",type:"danger"},(0,o.kt)("p",{parentName:"admonition"},"The Hudi extensions provide the ability to add field IDs to the parquet schema when writing with Hudi.\nThis is a requirement for some engines, like BigQuery and Snowflake, when reading an Iceberg table.\nIf you are not planning on using Iceberg, then you do not need to add these to your Hudi writers.")),(0,o.kt)("h4",{id:"steps-to-add-additional-configurations-to-the-hudi-writers"},"Steps to add additional configurations to the Hudi writers:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Add the extensions jar (",(0,o.kt)("inlineCode",{parentName:"li"},"hudi-extensions-0.1.0-SNAPSHOT-bundled.jar"),") to your class path",(0,o.kt)("br",{parentName:"li"}),"For example, if you're using the Hudi ",(0,o.kt)("a",{parentName:"li",href:"https://hudi.apache.org/docs/quick-start-guide#spark-shellsql"},"quick-start guide"),"\nfor spark you can just add ",(0,o.kt)("inlineCode",{parentName:"li"},"--jars hudi-extensions-0.1.0-SNAPSHOT-bundled.jar")," to the end of the command."),(0,o.kt)("li",{parentName:"ol"},"Set the following configurations in your writer options:",(0,o.kt)("br",{parentName:"li"}),(0,o.kt)("inlineCode",{parentName:"li"},"hoodie.avro.write.support.class: io.onetable.hudi.extensions.HoodieAvroWriteSupportWithFieldIds"),(0,o.kt)("inlineCode",{parentName:"li"},"hoodie.client.init.callback.classes: io.onetable.hudi.extensions.AddFieldIdsClientInitCallback")),(0,o.kt)("li",{parentName:"ol"},"Run your existing code that use Hudi writers")),(0,o.kt)("h4",{id:"using-biglake-metastore-to-create-the-iceberg-biglake-tables"},(0,o.kt)("a",{parentName:"h4",href:"https://cloud.google.com/bigquery/docs/iceberg-tables#create-using-biglake-metastore"},"Using BigLake Metastore to create the Iceberg BigLake tables"),":"),(0,o.kt)("p",null,"You can use two options to register OneTable synced Iceberg tables to BigLake Metastore:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"To directly register the OneTable synced Iceberg table to BigLake Metastore,\nfollow the ",(0,o.kt)("a",{parentName:"li",href:"/docs/biglake-metastore"},"OneTable guide to integrate with BigLake Metastore")),(0,o.kt)("li",{parentName:"ul"},"Use ",(0,o.kt)("a",{parentName:"li",href:"https://cloud.google.com/bigquery/docs/spark-procedures"},"stored procedures for Spark"),"\non BigQuery to register the table in BigLake Metastore and query the tables from BigQuery.")),(0,o.kt)("h3",{id:"hudi-and-delta-tables"},"Hudi and Delta tables"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/bigquery/docs/query-open-table-format-using-manifest-files"},"This document"),"\nexplains how to query Hudi and Delta table formats through the use of manifest files."))}g.isMDXComponent=!0}}]);